$(function(){var e={raceId:0,raceTimezone:"America/New_York",attributionParam:"rsus",cookieName:"analytics",cookieLifetime:365,commandQueue:null,eventsProcessed:0,attributionData:null,init:function(){this.log("Initializing...")},manageAttribution:function(){var a=this,b=null,d=a.getUrlVars();a.attributionParam in d?(b=a.parseAttribution(d[a.attributionParam]),a.isValidAttribution(b)&&(a.attributionData=b,a.createCookie(a.cookieName,JSON.stringify(a.attributionData),a.cookieLifetime)),a.log("Attribution set from query params.")):
(d=document.referrer,a.isReferrerSignificant(d)?a.retrieveAssetId(d).done(function(c){b={asset:c,source:1,medium:1};a.isValidAttribution(b)&&(a.attributionData=b,a.createCookie(a.cookieName,JSON.stringify(a.attributionData),a.cookieLifetime));e.log("Attribution set from referrer.")}).fail(function(a){e.log("Failed to set attribution data. Error: "+JSON.stringify(a))}):(a.attributionData=a.getAttributionFromCookie(),a.log("Attribution set from existing cookie.")))},getAttributionFromCookie:function(){var a=
this.readCookie(this.cookieName);if(null!==a)try{var b=JSON.parse(a);if(this.isValidAttribution(b))return b}catch(d){}return null},isReferrerSignificant:function(a){if(null!=a&&""!==$.trim(a)){var b=/[^:]+:\/\/(?:[^:/@]+@)?([^:\/]+)/.exec(a);return null!==b&&b[1]===window.location.hostname?(b=document.createElement("a"),b.href=a,"/Races"===b.pathname):!0}return!1},getUrlVars:function(){var a=[],b=window.location.search;if(b){b=b.substring(1).split("&");for(var d=0;d<b.length;d++){var c=/^([^=]*)(?:=(.*))?$/.exec(b[d]);
if(null!==c){var g=c[1];c=c[2];void 0===c&&(c=null);a[g]=c}}}return a},readCookie:function(a){a+="=";for(var b=document.cookie.split(";"),d=0;d<b.length;d++){for(var c=b[d];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(a))return c.substring(a.length,c.length)}return null},createCookie:function(a,b,d){var c="";d&&(c=new Date,c.setTime(c.getTime()+864E5*d),c="; expires="+c.toUTCString());document.cookie=a+"="+b+c+"; path=/"},parseAttribution:function(a){var b={};a=/^([0-9]+)-([0-9]+)-([0-9a-f-]+)$/.exec(a);
null!==a&&(b.source=parseInt(a[1]),b.medium=parseInt(a[2]),b.asset=a[3]);return b},retrieveAssetId:function(a){var b=this,d={type:"POST",contentType:"application/json",url:rsuAnalyticsEndpoints.referrer,data:JSON.stringify({referrer:a}),dataType:"json",async:!0,processData:!1,success:b.postSuccess};return function(a){var c=null,f=a||$.Deferred();(new b.ajaxWithRetry(d,3,500)).done(function(a){"asset_id"in a?(c=a.asset_id,f.resolve(c)):f.resolve(null)}).fail(function(a){e.log("Analytics error retrieving referrer asset id. Error: "+
JSON.stringify(a));f.fail("Analytics error retrieving referrer asset id. Error: "+JSON.stringify(a))});return f}().promise()},isValidAttribution:function(a){return"source"in a&&"medium"in a&&"asset"in a&&a.source===parseInt(a.source,10)&&a.medium===parseInt(a.medium,10)?a.asset.match(/^[a-fA-F0-9]{8,}-[a-fA-F0-9]{4,}-[a-fA-F0-9]{4,}-[a-fA-F0-9]{4,}-[a-fA-F0-9]{12,}$/):!1},processQueue:function(){this.commandQueue=window[window.Runalytics].q;this.log("Processing queue...");this.isJsonSupported()&&
this.log("q: "+JSON.stringify(this.commandQueue));if(this.commandQueue){for(var a=[],b=[],d=[],c=0;c<this.commandQueue.length;c++){var g=this.commandQueue[c];switch(g[0]){case "create":a.push(g);break;case "send":b.push(g);break;default:d.push(g)}}0<a.length&&this.processCreate(a);0<b.length&&this.processSend(b);0<d.length&&this.processUnknown(d);this.commandQueue=[];window[window.Runalytics].q=[]}},processCreate:function(a){this.log("processCreate");this.raceId=a[0][1];this.raceTimezone=a[0][2]},
processSend:function(a){for(var b={pageview:[],event:[],social:[],timing:[],unknown:[]},d,c=0;c<a.length;c++)(d=a[c][1])&&b.hasOwnProperty(d)?b[d].push(a[c]):b.unknown.push(a[c]);0<b.pageview.length&&this.handlePageviews(b.pageview);0<b.event.length&&this.handleEvents(b.event);0<b.social.length&&this.handleSocials(b.social);0<b.timing.length&&this.handleTimings(b.timing);0<b.unknown.length&&this.handleUnknown(b.unknown)},processUnknown:function(a){e.log("processUnknown: "+a)},postSuccess:function(a){e.log("Send was successful")},
handlePageviews:function(a){var b=this,d=1,c=1,g=null;null!==b.attributionData&&(d=b.attributionData.source,c=b.attributionData.medium,g=b.attributionData.asset);for(var f=[],h=0;h<a.length;h++)f.push({path:window.location.pathname,hash:window.location.hash,query:window.location.search,referrer:document.referrer,user_agent:navigator.userAgent,source_id:d,medium_id:c,event_id:1,asset_id:g,race_id:b.raceId,timezone:b.raceTimezone});0===b.eventsProcessed&&(f=b.removeDuplicates(f));a={type:"pageview",
data:f};"object"===typeof rsuAnalyticsEndpoints&&"string"===typeof rsuAnalyticsEndpoints.events&&b.isJsonSupported()&&(a={type:"POST",contentType:"application/json",url:rsuAnalyticsEndpoints.events,data:JSON.stringify(a),dataType:"json",async:!0,processData:!1,success:b.postSuccess},(new this.ajaxWithRetry(a,3,2E3)).done(function(a){e.log("Analytics success handling pageview");b.eventsProcessed+=a.length}).fail(function(a){e.log("Analytics error handling pageview. Error: "+JSON.stringify(a))}))},
handleEvents:function(a){for(var b=this,d=[],c=0;c<a.length;c++)d.push({asset_id:a[c][4],medium_id:1,event_id:1,source_id:1,race_id:b.raceId,timezone:b.raceTimezone});0===b.eventsProcessed&&(d=b.removeDuplicates(d));a={type:"event",data:d};"object"===typeof rsuAnalyticsEndpoints&&"string"===typeof rsuAnalyticsEndpoints.events&&b.isJsonSupported()&&(a={type:"POST",contentType:"application/json",url:rsuAnalyticsEndpoints.events,data:JSON.stringify(a),dataType:"json",async:!0,processData:!1,success:b.postSuccess},
(new this.ajaxWithRetry(a,3,2E3)).done(function(a){e.log("obj: "+JSON.stringify(a));b.eventsProcessed+=d.length}).fail(function(a){e.log("Analytics error handling event. Error: "+JSON.stringify(a))}))},handleSocials:function(a){e.log("Social Unsupported")},handleTimings:function(a){e.log("Timing Unsupported")},handleUnknown:function(a){e.log("handleUnknown: "+a)},log:function(a){window.localStorage&&window.localStorage.outputAnalytics&&"T"===window.localStorage.outputAnalytics&&console.log(a)},isJsonSupported:function(){return"object"===
typeof JSON&&"function"===typeof JSON.stringify&&"function"===typeof JSON.parse},removeDuplicates:function(a){if(!this.isJsonSupported())return a;for(var b={},d=[],c,e=0;e<a.length;e++)c=JSON.stringify(a[e]),b[c]||(d.push(a[e]),b[c]=!0);return d},ajaxWithRetry:function(a,b,d){function c(b){e.log("Trying ajax #"+(f+1));var d=b||$.Deferred();$.ajax(a).done(function(a){f++;d.resolve(a)}).fail(function(a){f++;f-1<g?(a=h+(f-1)*h,e.log("Waiting "+a+"ms before retrying..."),setTimeout(function(){c(d)},a)):
(e.log("Giving up"),d.reject(a))});return d}var g="number"===typeof b?b:0,f=0,h="number"===typeof d?d:0;return c().promise()}};try{e.init(),e.manageAttribution(),setTimeout(function(){e.processQueue()},2500),setInterval(function(){e.processQueue()},5E3)}catch(a){}});

//4f767a886122289484ee58bec5265e17
