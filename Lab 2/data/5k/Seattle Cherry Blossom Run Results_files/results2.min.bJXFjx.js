var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$(function(){$("#embed-results").on("click",function(){$(this).toggleClass("open");$("#results-embed-code").slideToggle();$(this).toggleClass("is-active-search")});$("#toggleDivisionResults").on("click",function(){$(this).toggleClass("open");$("#divisionResults").slideToggle()});$("#search").on("click",function(c){c.preventDefault();c=$("#resultsSearch");var f=c.val();if(f){var h=$("#resultsSearchAutoComplete"),g=h.children(".selected");if(0!=g.length)g.click();else{g=$(document.createElement("span"));
var l=document.createElement("input"),m=null;l.type="hidden";l.name="any[]";l.value=f;g.addClass("searchedText");g.append(l);g.append($(document.createTextNode(f)));g.append($(document.createElement("span")).on("click",function(){$(this.parentNode).remove();m.submit()}).attr("title","Remove this Search Term").html("&times;"));$("#hiddenSearches").append(g);c.val("");h.empty().css("display","none");m=$(l.form);m.submit()}}});var a=1,b=0,d=null,e={};$("#resultsSearch").on("keyup",function(c){a++;var f=
$(this),h=$("#resultsSearchAutoComplete");if(38==c.keyCode)return c=h.children(".selected"),0==c.length?h.children(":first").addClass("selected"):(c.removeClass("selected"),c.prev().addClass("selected")),!1;if(40==c.keyCode)return c=h.children(".selected"),0==c.length?h.children(":first").addClass("selected"):(c.removeClass("selected"),c.next().addClass("selected")),!1;if(27==c.keyCode)return h.empty().css("display","none"),!1;if(11==c.which||13==c.which)return c.preventDefault(),b=a-1,c=h.children(".selected"),
0!=c.length?c.click():$("#search").click(),h.empty().css("display","none"),!1;d&&(clearTimeout(d),d=null);(function(){function g(n){b=l;h.empty();h.toggle(0<n.length);var k=f.offset(),r=h.offsetParent().offset();h.css({display:"block",top:k.top-r.top+f.outerHeight()+"px",left:k.left-r.left-(f.outerWidth()-f.innerWidth())/2+"px",width:f.outerWidth()+"px"});for(k=0;k<n.length;k++)r=n[k],$(document.createElement("div")).addClass("autocompleteOption").text(r).data("searchKey","any[]").data("searchValue",
r).on("mouseover",function(){$("#resultsSearchAutoComplete").children().removeClass("selected");$(this).addClass("selected")}).on("click",function(){var t=$(this);(function(){var u=$(document.createElement("span")),y=document.createElement("input"),C=null;y.type="hidden";y.name=t.data("searchKey");y.value=t.data("searchValue");u.addClass("searchedText");u.append(y);u.append($(document.createTextNode(t.text())));u.append($(document.createElement("span")).on("click",function(){$(this.parentNode).remove();
C.submit()}).attr("title","Remove this Search Term").html("&times;"));$("#hiddenSearches").append(u);f.val("");h.empty().css("display","none");C=$(y.form);C.submit()})()}).appendTo(h)}var l=a,m=f.val().toLowerCase();!m||2>m.length?(b=l,h.empty().css("display","none")):e[m]&&3E4>(new Date).getTime()-e[m].time.getTime()?g(e[m].values):d=setTimeout(function(){var n={type:"GET",dataType:"json",url:"/Race/Results/Search/"+Results.data.resultSet.setInfo.individual_result_set_id+"?q="+encodeURIComponent(m),
timeout:5E3};$.ajax(n).done(function(k){l>b&&!k.error&&(g(k.values),e[m]={values:k.values,time:new Date})})},250)})();return!0})});
var Results={eventNames:{},data:null,columnData:[],sortedStringValues:null,numPerPage:100,numPages:1,currentPage:1,mobile:600>$(window).width(),editable:!1,dontCacheNextRefresh:!1,resultsEditPopup:null,resultsEditingWaitingPopup:null,errorPopup:null,lastAjaxUrl:null,lastAjaxTs:0,lastAjaxReqId:0,lastRenderedAjaxReqId:0,everyToolPanel:null,everyToolButton:null,filtersPanel:null,editPanel:null,resultsTable:null,isSimpleResults:!1,addEventInfo:function(a,b){this.eventNames[a]=b},init:function(){var a=
this;this.everyToolPanel=$("#toolPanels .tool-panel");this.everyToolButton=$("#resultsTableTools button.jsToolButton");this.filtersPanel=$("#filtersToolPanel");this.editPanel=$("#editToolPanel");this.resultsTable=$("#resultsTable");if(window.location.hash)for(var b=window.location.hash.substr(1).split(";"),d=0;d<b.length;d++){var e=b[d],c;null!==(c=/^resultSetId-([0-9]+)$/.exec(e))?(e=$("#resultsSelect").fauxSelectOptions(),e.removeClass("selected"),e=e.filter("[data-value='"+c[1]+"']"),e.addClass("selected"),
(c=e.data("year"))&&$("#resultsYearSelect").fauxSelectOptions().removeClass("selected").filter("[data-value='"+c+"']").addClass("selected")):null!==(c=/^page:([0-9]+)$/.exec(e))?a.currentPage=parseInt(c[1]):null!==(c=/^perpage:([0-9]+)$/.exec(e))&&(a.numPerPage=Math.min(2E3,parseInt(c[1])))}a.setupYearSelect();$("#resultsSelect").fauxSelect(function(f){a.processNewlySelectedResults()});b=$("#currentPageInput");b.val(a.currentPage);b.on("focus",function(){$(this).data("pre-focus-val",this.value);this.value=
""});b.on("keydown",function(f){13==f.which&&(this.blur(),Results.changePage(this.value))});b.on("blur",function(f){(f=this.value)?Results.currentPage!=f&&Results.changePage(f):this.value=$(this).data("pre-focus-val")});$("#resultsPerPageSelect").val(a.numPerPage).on("change",function(){this.blur();Results.changeNumPerPage($(this).val())});this.setupSearch();this.setupDivisionFilter();a.loadResults();a.setupTableHeader()},setupYearSelect:function(){var a=this,b=$("#resultsYearSelect");b.fauxSelect(function(d){a.filterResultsByYear(b)});
this.filterResultsByYear(b)},filterResultsByYear:function(a){var b=a.fauxSelectVal();a=$("#resultsSelect");var d=a.fauxSelectOptions();b=d.hide().filter("[data-year='"+b+"']").show();d.not(b).removeClass("selected");0==d.filter(".selected").length&&(d=b.filter("[data-value],.customResultsPage").first(),0===d.length&&(d=b.filter("[data-select-instr='T']").first()),d.addClass("selected"),a.updateFauxSelectText(),this.processNewlySelectedResults())},processNewlySelectedResults:function(){var a=$("#resultsSelect").fauxSelectSelectedOption();
a.data("value")?($("#integrated-search-adv-container,#advanced-search").show(),this.changePage(1),this.loadResults()):a.is("a.customResultsPage")?window.location=a.prop("href"):$("#integrated-search-adv-container,#advanced-search").hide()},setupDivisionFilter:function(){var a=this,b=$("#resultsDivisionSelect"),d=b.fauxSelectVal(),e=b.fauxSelectOptions();e.not(":first").remove();e=e.first();e.addClass("selected");if(this.data&&this.data.divisions&&0<this.data.divisions.length){var c={};if(this.data.divisionResults){c=
this.data.divisionResults;for(var f in c)if(c.hasOwnProperty(f))break}for(var h=!1,g=0;g<this.data.divisions.length;g++){var l=this.data.divisions[g];f=l.race_division_id;if(!l.show_top_num||f in c&&c[f].results&&0<c[f].results.length){h=!0;break}}for(g=0;g<this.data.divisions.length;g++)if(l=this.data.divisions[g],f=l.race_division_id,!h||!l.show_top_num||f in c&&c[f].results&&0<c[f].results.length){var m=e.clone(!1);m.removeClass("selected").attr("data-value",f).text(l.division_name);e.parent().append(m);
d==f&&(m.addClass("selected"),e.removeClass("selected"))}b.show().closest(".resultsSelectContainer").show()}else b.hide().closest(".resultsSelectContainer").hide();b.fauxSelect(function(n){a.filterResults()})},setupTableHeader:function(){var a=this;a.getResultsTable();Results.everyToolButton.on("click",function(b){b.preventDefault();b=$(this).data("action");Results.resultsTable.hasClass("editMode")&&"edit-mode"!=b&&a.cancelEditMode();switch(b){case "filters":Results.toggleToolPanel(Results.filtersPanel,
$(this));break;case "edit-mode":Results.resultsTable.hasClass("editMode")?Results.editPanel.animate({height:"toggle",opacity:"toggle"},{duration:500,complete:function(){Results.cancelEditMode()}}):(Results.toggleToolPanel(Results.editPanel,$(this)),Results.editColumns($(this)));break;case "add-result":Results.everyToolPanel.hide();Results.addResult();break;case "add-virtual-result":Results.addVirtualResult()}})},toggleToolPanel:function(a,b){$(a).is(":visible")?$(a).animate({opacity:"toggle",height:"toggle"},
500):(Results.everyToolPanel.hide(),$(a).animate({height:"toggle",opacity:"toggle"},500))},cancelEditMode:function(){var a=this.getResultsTable();$(a).empty();this.loadResults();$(a).removeClass("editMode")},getResultsTable:function(){return document.getElementById("resultsTable")},filterResults:function(){try{1!=this.currentPage?this.changePage(1):this.refreshResults()}catch(a){}},showError:function(a){Results.errorPopup&&0<Results.errorPopup.length?(Results.errorPopup.find("div.error").text(a),
Results.errorPopup.dialog("open")):alert(a)},getResultsAjaxParams:function(a){var b=$("#resultsSelect").fauxSelectVal();b=urlAddParam(""+window.location,"resultSetId",b).replace(/#.*$/,"");this.mobile&&(b=urlAddParam(b,"mobile","T"));b=urlAddParam(b,"skipData",null);b=urlAddParam(b,"textVersion",null);b=urlAddParam(b,"page",this.currentPage?this.currentPage:1);b=urlAddParam(b,"num",this.numPerPage?this.numPerPage:100);var d=$("#resultsDivisionSelect").fauxSelectVal();d&&(b=urlAddParam(b,"division",
d));this.searchForm&&(b+="&"+this.searchForm.serialize());this.dontCacheNextRefresh&&(b+="&noCache");this.dontCacheNextRefresh=!1;if((d=this.getResultsTable())&&0<d.rows.length){var e=$(d.rows[0]).children("th");d=[];for(var c=0,f=Results.editable?1:0,h=0;h<e.length-f;h++){for(;h+c<this.data.headings.length&&this.data.headings[h+c].hidden;)c++;var g=this.data.headings[h+c],l=e.eq(h+f),m=l.hasClass("sortUp"),n=l.hasClass("sortDown");l=l.data("sortPriority");g=g.sortKey?g.sortKey:g.key;m?d.push([l,
"&order[]="+encodeURIComponent("+"+g)]):n&&d.push([l,"&order[]="+encodeURIComponent("-"+g)])}d.sort(function(k,r){return k[0]>r[0]?-1:1});for(e=0;e<d.length;e++)b+=d[e][1]}d=(new Date).getTime();if(a&&this.lastAjaxUrl===b&&1E3>d-this.lastAjaxTs)return null;this.lastAjaxUrl=b;this.lastAjaxTs=d;return{url:b,type:"GET",dataType:"json"}},loadResults:function(){var a=this,b=$("#resultsSelect").fauxSelectVal();$(this.getResultsTable()).empty();$("#resultsHeadings,#resultsContainer,#pendingResults").hide();
var d=$("#results-embed-container");d.hide();if("pending"===b)$("#pendingResults").slideDown();else if(b){window.location.hash="#resultSetId-"+b;var e=d.find("code");1==e.length&&(e.html(e.html().replace(/resultSetId=[0-9]+/,"resultSetId="+b)),d.show());d=$("#resultsSearchLink");1==d.length&&d.prop("href",d.data("base-url")+"?resultSetId="+b);$("#loadingAnimation").prop("hidden",!1);this.errorPopup||(this.errorPopup=$("#resultsErrorPopup"),this.errorPopup.dialog({autoOpen:!1,width:550,title:"Error",
modal:!0,closeText:""}));Results.editable&&!this.resultsEditPopup&&(this.resultsEditingWaitingPopup=$("#resultsPopup-wait"),this.resultsEditingWaitingPopup.dialog({autoOpen:!1,closeOnEscape:!1,width:550,title:"Please Wait...",modal:!0,classes:{"ui-dialog":"style1"},open:function(){$(this).data("hadStyle1",$(".ui-widget-overlay").hasClass("style1"));$(".ui-widget-overlay").addClass("style1")},close:function(){$(this).data("hadStyle1")||$(".ui-widget-overlay").removeClass("style1")},beforeClose:function(){return $(this).data("allowClose")},
closeText:""}),this.resultsEditPopup=$("#resultsPopup"),this.resultsEditPopup.dialog({autoOpen:!1,width:Math.min(1200,$(window).width()),modal:!0,classes:{"ui-dialog":"style1"},open:function(){$(this).data("hadStyle1",$(".ui-widget-overlay").hasClass("style1"));$(".ui-widget-overlay").addClass("style1")},close:function(){$(this).data("hadStyle1")||$(".ui-widget-overlay").removeClass("style1")},beforeClose:function(){return Results.resultsEditPopup.data("edited")?confirm("Are you sure you want to close this window?  You will lose any changes you have made."):
!0},closeText:""}),this.resultsEditPopup.find("form:first").on("submit",function(){var f=$(this),h=f.find("div.error"),g=h.last();h.empty();if(Results.resultsEditPopup.data("edited")){var l=$("#resultsPopup-editResults-animation");l.show();$("html, body").animate({scrollTop:l.offset().top-$(window).height()+l.outerHeight()},250);h={type:"POST",dataType:"json",data:f.serialize()};f.attr("action")&&(h.url=f.attr("action"));$.ajax(h).done(function(m){var n=Results.resultsEditPopup.find(":input:not(:submit):not(:disabled)");
if("error"in m){if(g.text(m.error),"inputErrors"in m)for(key in m.inputErrors)n.filter("[name='"+key+"']").nextAll("div.error:first").text(m.inputErrors[key])}else{Results.resultsEditPopup.data("edited",!1).dialog("close");if("warnings"in m){var k=$(document.createElement("div"));$(document.body).append(k);for(n=0;n<m.warnings.length;n++)k.append($(document.createElement("div")).text(m.warnings[n]));k.dialog({height:140,modal:!0,title:"Warning!",close:function(){k.remove()},closeText:""})}Results.dontCacheNextRefresh=
!0;Results.refreshResults()}}).fail(function(){g.text("Failed to save changes.")}).always(function(){l.hide()})}else Results.resultsEditPopup.dialog("close")}));$("#resultsContainer").toggleClass("mobile",this.mobile&&480>=$(window).width());var c=++a.lastAjaxReqId;$.ajax(a.getResultsAjaxParams(!1)).done(function(f){f||(f={error:"Failed to load results."});if(f.error)Results.showError(f.error);else if(c>a.lastRenderedAjaxReqId){a.lastRenderedAjaxReqId=c;Results.data=f;var h=null!==f.resultSet.setInfo.results_source_name,
g=$("#resultsSourceDiv");h?(g.show(),h=g.find("a:first"),f.resultSet.setInfo.results_source_url?h.attr("href",f.resultSet.setInfo.results_source_url).text(f.resultSet.setInfo.results_source_name).show():g.find("span.timer").text(f.resultSet.setInfo.results_source_name)):g.hide();var l=$("#questionsAboutResults");(function(){var k=$("#resultQuestionsPopup"),r=$("#resultQuestionsOverlay");l.show();var t=l.find("a.link");t.off("click.popup");if(f.resultSet.setInfo.result_questions_url)t.prop("href",
f.resultSet.setInfo.result_questions_url);else t.on("click.popup",function(C){C.preventDefault();showStyle1Popup(k,"Questions About Results",Math.min(800,$(window).width()))});var u=!1,y=k.find("form");y.find("input[name='resultSetId']").val(b);y.off("submit").on("submit",function(C){C.preventDefault();u||(grecaptcha.getResponse()?(u=!0,r.show(),$.ajax({url:y.prop("action"),type:"POST",dataType:"json",data:y.serialize()}).done(function(E){E||(E={error:"Failed to submit question."});E.error?Results.showError(E.error):
(k.dialog("close"),showPopupMessage("Question Submitted","<p>Your question has been successfully submitted.</p>","Close"))}).fail(function(){Results.showError("Failed to submit question.")}).always(function(){u=!1;r.hide()})):showError("Please complete the reCaptcha verification."))})})();$("#preliminaryResults").toggle("T"==f.resultSet.setInfo.preliminary_results);g=$("#editingOptions");Results.editable?(g.show(),g=g.find("span[data-action='edit-cols']"),(h=g.data("initial-text"))?g.text(h):(g.data("initial-text",
g.text()),g.off("click").on("click",function(){Results.editColumns($(this))})),$("#saveTableChanges").off("click").on("click",function(){Results.saveColumns($(this));Results.toggleToolPanel()}),$("#discardTableChanges").off("click").on("click",function(){Results.cancelEditMode();Results.toggleToolPanel()})):g.hide();g=$("#resultsPerPageSelect");g.empty();h=[10,25,50,100,250,1E3];a.isSimpleResults&&(a.numPerPage=10);for(var m=a.numPerPage,n=0;n<h.length&&(0==n||h[n]<=Math.max(m,f.resultSet.numResults));n++)g.append('<option value="'+
h[n]+'" '+(a.numPerPage==h[n]?'selected="selected"':"")+">"+h[n]+"</option>");5E3>=f.resultSet.numResults&&g.append('<option value="5000" '+(5E3==a.numPerPage?'selected="selected"':"")+">All</option>");g.val(m);$("#resultsHeadings,#resultsContainer").show();g=$("#teamResultsLink");g.exists()&&(h=g.prop("href").replace(/#.*$/,""),f.teamResultSetId&&(h+="#set:"+f.teamResultSetId),g.prop("href",h));Results.changeNumPerPage(0==a.numPerPage?100:a.numPerPage);$("#loadingAnimation").prop("hidden",!0);Results.buildResultsTable(!0);
Results.showDivisionResults()}}).fail(function(){Results.showError("Failed to load results.")}).always(function(){$("#loadingAnimation").prop("hidden",!0)})}else $("#useResultsSelectorNote").show()},refreshResults:function(){var a=this;a.showOverlay();var b=a.getResultsAjaxParams(!0);if(null!==b){var d=++a.lastAjaxReqId;$.ajax(b).done(function(e){e||(e={error:"Failed to load results."});if(e.error)a.showError(e.error);else if(d>a.lastRenderedAjaxReqId){a.lastRenderedAjaxReqId=d;a.data=e;var c=$("#resultsPerPageSelect");
c.empty();for(var f=[10,25,50,100,250,1E3],h=0;h<f.length&&(0==h||f[h]<=Math.max(a.numPerPage,e.resultSet.numResults));h++)c.append('<option value="'+f[h]+'" '+(a.numPerPage==f[h]?'selected="selected"':"")+">"+f[h]+"</option>");5E3>=e.resultSet.numResults&&c.append('<option value="5000" '+(5E3==a.numPerPage?'selected="selected"':"")+">All</option>");$("#resultsHeadings,#resultsContainer").show();a.changeNumPerPage(0==a.numPerPage?100:a.numPerPage);a.currentPage>a.numPages&&a.changePage(a.numPages);
a.buildResultsTable(!0);a.showDivisionResults();c=$(a.getResultsTable()).offset().top;c-=$("div.stickyHeader").height();0>c&&(c=0);$("html, body").animate({scrollTop:c},250);$("#preliminaryResults").toggle("T"==e.resultSet.setInfo.preliminary_results)}}).fail(function(){a.showError("Failed to load results.")}).always(function(){a.hideOverlay()})}},showOverlay:function(){var a=$(this.getResultsTable());$("#resultsTableOverlay").css({width:a.width(),height:a.height(),display:"block"})},hideOverlay:function(){$("#resultsTableOverlay").delay(400).fadeOut()},
changeNumPerPage:function(a){var b=this.numPerPage;this.numPerPage=parseInt(a,10);isNaN(this.numPerPage)&&(this.numPerPage=100);this.numPages=Math.ceil(this.data.resultSet.numResults/this.numPerPage);0==this.numPages&&(this.numPages=1);$("#totalPages").text(this.numPages);b!=this.numPerPage&&(1!=this.currentPage?this.changePage(1):this.refreshResults())},changePage:function(a){a=parseInt(a,10);isNaN(a)?a=1:0>a?a=1:a>this.numPages&&(a=this.numPages);this.currentPage!=a&&(this.currentPage=a,$("#currentPageInput").val(a),
this.refreshResults())},nextSortPriority:1,sortResults:function(a,b){if(b<this.data.headings.length&&!this.data.headings[b].nonSortable){switch(a.attr("class")){case "sortUp":a.toggleClass("sortUp").toggleClass("sortDown").data("sortPriority",this.nextSortPriority++);break;case "sortDown":a.toggleClass("sortDown").data("sortPriority",this.nextSortPriority--);break;default:a.toggleClass("sortUp")}this.refreshResults()}},searchForm:null,setupSearch:function(){var a=this;a.searchForm=$("#results-search-form");
a.searchForm.on("submit",function(b){b.preventDefault();a.filterResults()});a.searchForm.find(":input").not("#resultsSearch").on("change",function(){a.filterResults()})},buildResultRow:function(a,b,d,e,c){!d&&e&&Results.editable&&0<a.children.length&&$(a.children[0]).remove();d=0;if(c)for(e=0;e<c.length;e++){if(e<a.children.length)var f=a.children[e];else f=document.createElement("td"),a.appendChild(f);$(f).html(b[c[e]]?htmlspecialchars(b[c[e]],["b","u","i"]).replace(/\n/g,"<br/>"):"");d++;"align"in
this.data.headings[c[e]]&&$(f).css("text-align",this.data.headings[c[e]].align);"style"in this.data.headings[c[e]]&&$(f).addClass(this.data.headings[c[e]].style)}else for(e=0;e<b.length;e++)e<a.children.length?f=a.children[e]:(f=document.createElement("td"),a.appendChild(f)),$(f).html(b[e]?htmlspecialchars(b[e],["b","u","i"]).replace(/\n/g,"<br/>"):""),d++;for(;a.children.length>d;)a.removeChild(a.children[a.children.length-1])},showDivisionResults:function(){var a=$("#divisionResults");if(1==a.length){a.empty();
this.setupDivisionFilter();if(0<Object.keys(this.data.overallDivisionResults).length&&this.data.overallDivisionResults.results&&0<this.data.overallDivisionResults.results.length){var b=this.data.overallDivisionResults.results,d=document.createElement("h5");d.appendChild(document.createTextNode("Overall Winners"));a.append(d);var e=document.createElement("table"),c=document.createElement("thead"),f=document.createElement("tbody");e.className="results";for(var h=this.data.overallDivisionResults.headings,
g=null,l=document.createElement("tr"),m=0;m<h.length;m++){"Name"===h[m]&&(g=m);var n=document.createElement("th");$(n).addClass("noSort").html(htmlspecialchars(h[m]).replace(/\n/g,"<br/>"));l.appendChild(n)}c.appendChild(l);e.appendChild(c);c=this.data.overallDivisionResults.auxData;for(m=0;m<b.length;m++)l=document.createElement("tr"),$(l).attr("data-result-url",c.resultUrls[m]),$(l).off("click").on("click",function(t){if(!$(l).parents("table").hasClass("editMode")){var u=$(this).data("result-url");
t.ctrlKey||t.metaKey?openWindow(u):setWindowLocation(u)}}),this.buildResultRow(l,b[m],!0,!1),null!==g&&this.formatName(l,g,c.divisionRowFirstNameLens[m],!1,null),f.appendChild(l);e.appendChild(f);a.append(e)}if(this.data.divisions&&0<Object.keys(this.data.divisionResults).length)for(d=0;d<this.data.divisions.length;d++){e=this.data.divisions[d];var k=e.race_division_id;if(this.data.divisionResults[k].results&&0<this.data.divisionResults[k].results.length){b=this.data.divisionResults[k].results;var r=
document.createElement("h5");r.appendChild(document.createTextNode(e.division_name));a.append(r);e=document.createElement("table");c=document.createElement("thead");f=document.createElement("tbody");e.className="results";h=this.data.divisionResults[k].headings;g=null;l=document.createElement("tr");for(m=0;m<h.length;m++)"Name"===h[m]&&(g=m),n=document.createElement("th"),$(n).addClass("noSort").html(htmlspecialchars(h[m]).replace(/\n/g,"<br/>")),l.appendChild(n);c.appendChild(l);e.appendChild(c);
c=this.data.divisionResults[k].auxData;for(m=0;m<b.length;m++)l=document.createElement("tr"),$(l).attr("data-result-url",c.resultUrls[m]),$(l).off("click").on("click",function(t){if(!$(l).parents("table").hasClass("editMode")){var u=$(this).data("result-url");t.ctrlKey||t.metaKey?openWindow(u):setWindowLocation(u)}}),this.buildResultRow(l,b[m],!0,!1),null!==g&&this.formatName(l,g,c.divisionRowFirstNameLens[m],!1,null),f.appendChild(l);b=document.createElement("tr");g=document.createElement("td");
c=document.createElement("a");g.colSpan=h.length;g.className="center";c.appendChild(document.createTextNode("Click here to see more."));c.href="#division-"+k;c.style.textDecoration="none";c.className="more";g.appendChild(c);b.appendChild(g);f.appendChild(b);$(c).on("click",function(t){t.preventDefault()});$(b).add(r).data("divisionId",k).on("click",function(t){t=$(this).data("divisionId");$("#resultsDivisionSelect").fauxSelectVal(t)});r.style.cursor="pointer";e.appendChild(f);a.append(e)}}}$("#divisionResultsLink").toggle(0<
a.children().length)},buildResultsTable:function(a){var b=this.getResultsTable();$(b).prop("hidden",!0);var d=Results.editable?1:0,e=!1;if(0==b.children.length){var c=document.createElement("thead");this.isSimpleResults&&c.classList.add("tt-upper");for(var f=document.createElement("tr"),h,g=0;g<this.data.headings.length;g++){if(0===g&&Results.editable){var l=document.createElement("th");$(l).addClass("noSort actions noDrag");f.appendChild(l)}if(!Results.data.headings[g].hidden){var m=$();Results.data.headings[g].tooltip&&
"undefined"!=typeof initializeRsuTippy&&(m=$('<i class="icon icon-info tippy-tip" tabindex="0"></i>'),m.attr("data-tippy-content",htmlspecialchars(htmlspecialchars(Results.data.headings[g].tooltip))),e=!0);(function(){var w=g;h=document.createElement("th");$(h).data("headerKey",g).html(htmlspecialchars(Results.data.headings[g].name).replace(/\n/g,"<br/>")).append(m);if(Results.data.headings[g].nonSortable)$(h).addClass("noSort");else $(h).on("click.sort",function(){Results.sortResults($(this),w)});
f.appendChild(h)})()}}c.appendChild(f);b.appendChild(c);c=document.createElement("tbody");b.appendChild(c)}if(2==b.children.length){c=b.children[1];0<c.children.length&&1<c.children[0].children[0].colSpan&&c.removeChild(c.children[0]);for(var n=[],k=d;k<b.tHead.rows[0].cells.length;k++)this.data.headings[$.data(b.tHead.rows[0].cells[k],"headerKey")].hidden||n.push($.data(b.tHead.rows[0].cells[k],"headerKey"));for(l=Math.min(this.numPerPage,this.data.resultSet.results.length);c.children.length<l;){f=
document.createElement("tr");for(k=d;k<n.length;k++)f.appendChild(document.createElement("td"));c.appendChild(f)}for(;c.children.length>l;)c.removeChild(c.children[l]);var r=d=null,t=null,u=null,y=null,C=null,E=null,K=null,L=null,M=null,G={},I=null,B=function(w){for(var x=0;x<n.length;x++)if(n[x]===w)return x;return w};for(k=0;k<this.data.headings.length;k++)"name"!==this.data.headings[k].key||this.data.headings[k].hidden&&!this.isSimpleResults?"profile_image_url"==this.data.headings[k].key?u=k:"gender"===
this.data.headings[k].key?y=k:"age"===this.data.headings[k].key?C=k:"state"===this.data.headings[k].key?E=k:"bib_num"===this.data.headings[k].key?K=k:"division"===this.data.headings[k].key?M=k:"division_place"!==this.data.headings[k].key||this.data.headings[k].hidden?"clock_time"!=this.data.headings[k].key||this.data.headings[k].hidden?"chip_time"!=this.data.headings[k].key||this.data.headings[k].hidden?(match=/^split_([0-9]+)$/.exec(this.data.headings[k].key))&&!this.data.headings[k].hidden?G[match[1]]=
B(k):"group_team_name"!==this.data.headings[k].key||this.data.headings[k].hidden||(I=B(k)):t=B(k):r=B(k):L=B(k):d=B(k);for(rowNum=0;rowNum<l;rowNum++){f=c.children[rowNum];$(f).attr("data-result-url",this.data.resultUrls[rowNum]);B=rowNum;var v=this.data.resultSet.results[B],O=this.data.resultSet.resultIds&&B<this.data.resultSet.resultIds.length?this.data.resultSet.resultIds[B]:null;this.buildResultRow(f,v,!1,a,n);var J="";if("resultUrls"in this.data&&null!==d&&rowNum in this.data.resultUrls)if(this.isSimpleResults){J=
this.formatSimpleParticipant(f,d,this.data.auxData.rowFirstNameLens[rowNum],!0,v[u],v[y],v[C],v[E],v[K]);var D=v[M];"undefined"!==typeof D&&$(f).find("td").eq(L).append($('<p class="fs-xs-2 fw-normal padding-0"></p>').text(D))}else J=this.formatName(f,d,this.data.auxData.rowFirstNameLens[rowNum],!0,v[u]);"raceGroupMarkdownUrls"in this.data&&null!==I&&rowNum in this.data.raceGroupMarkdownUrls&&this.formatRaceGroupName(f,I,this.data.raceGroupMarkdownUrls[rowNum]);if(null!==r&&Results.data.videoSettings&&
Results.data.videoSettings.finishLine){var z=Results.data.videoSettings.finishLine;D=$(f).find("td").eq(r);var q=v[n[r]];if(q){var p=q.split(":").reverse(),A=Math.round(parseFloat(p[0]));1<p.length&&(A+=60*p[1]);2<p.length&&(A+=3600*p[2]);q=null;for(k=0;null===q&&k<z.offsets.length;k++)p=z.offsets[k],p.clock_time_start_sec<=A&&p.clock_time_end_sec>=A&&(q=p.video_offset_sec+(A-p.clock_time_start_sec)-z.play_start_padding_sec);null!==q&&(q=Math.max(0,q),k="",p=Math.floor(q/3600),0<p&&(q%=3600,k+=p+
"h"),p=Math.floor(q/60),q%=60,k+=p+"m"+q+"s",z="https://www.youtube.com/watch?v="+z.video_id+"&t="+k,tmpA=$(document.createElement("a")),tmpA.attr("href",z),tmpA.attr("target","_blank"),tmpA.html('<div style="width:80px;margin-top:7px;"><i class="icon icon-film2" aria-hidden="true"></i> Video</div>'),tmpA.on("click",function(w){w.stopPropagation()}),D.append("<br/>"),D.append(tmpA))}}for(splitId in G)if(Results.data.videoSettings&&"splits"in Results.data.videoSettings&&splitId in Results.data.videoSettings.splits&&
(z=Results.data.videoSettings.splits[splitId],D=$(f).find("td").eq(G[splitId]),q=v[n[G[splitId]]])){p=q.split(":").reverse();A=Math.round(parseFloat(p[0]));1<p.length&&(A+=60*p[1]);2<p.length&&(A+=3600*p[2]);r&&t&&(p=v[n[r]].split(":").reverse(),q=Math.round(parseFloat(p[0])),1<p.length&&(q+=60*p[1]),2<p.length&&(q+=3600*p[2]),p=v[n[t]].split(":").reverse(),k=Math.round(parseFloat(p[0])),1<p.length&&(k+=60*p[1]),2<p.length&&(k+=3600*p[2]),q>k&&(A+=q-k));q=null;for(k=0;null===q&&k<z.offsets.length;k++)p=
z.offsets[k],p.clock_time_start_sec<=A&&p.clock_time_end_sec>=A&&(q=p.video_offset_sec+(A-p.clock_time_start_sec)-z.play_start_padding_sec);null!==q&&(q=Math.max(0,q),k="",p=Math.floor(q/3600),0<p&&(q%=3600,k+=p+"h"),p=Math.floor(q/60),q%=60,k+=p+"m"+q+"s",z="https://www.youtube.com/watch?v="+z.video_id+"&t="+k,tmpA=$(document.createElement("a")),tmpA.attr("href",z),tmpA.attr("target","_blank"),tmpA.text("Video"),tmpA.on("click",function(w){w.stopPropagation()}),D.append("<br/>"),D.append(tmpA))}if(Results.editable){v=
$(document.createElement("td"));v.addClass("actions");var H=$(document.createElement("div"));H.addClass("button-wrapper");v.append(H);(function(w){var x=$(document.createElement("button"));x.addClass("icon icon-edit");x.attr("title","Edit this Result");x.on("click",function(F){F.stopPropagation();Results.editResult(w)});H.append(x)})(B);(function(w,x){var F=$(document.createElement("button"));F.addClass("icon icon-cancel-circle");F.attr("title","Delete this Result");F.on("click",function(N){N.stopPropagation();
N.preventDefault();Results.deleteResult(w,x)});H.append(F)})(O,J);$(f).prepend(v)}(function(){$(f).off("click").on("click",function(w){if(!$(f).parents("table").hasClass("editMode")){var x=$(this).data("result-url");w.ctrlKey||w.metaKey?openWindow(x):setWindowLocation(x)}})})()}for(;rowNum<l;rowNum++)c.children[rowNum].style.display="none";0===this.data.resultSet.results.length&&(a=$('<tr><td colspan="'+$(b).children("thead").children().children().length+'" class="ta-center"></td></tr>'),l="There are no results matching your search",
d=this.data.resultSet.setInfo.race_category_id,d in this.eventNames&&(l+=" in the following event: "+this.eventNames[d]),l+=".",a.find("td").text(l),$(c).append(a));e&&initializeRsuTippy();this.setupPaging()}$(b).prop("hidden",!1);b="#resultSetId-"+this.data.resultSet.setInfo.individual_result_set_id;1!==this.currentPage&&(b+=";page:"+this.currentPage);b+=";perpage:"+this.numPerPage;window.location.hash=b},setupPaging:function(){var a=$("#resultsTableNav");a.find(".jsPagingButton").remove();if(0<
a.length){var b=this.currentPage;(function(){var e=Results.currentPage-1,c=$(document.createElement("a"));c.addClass("rsuBtn rsuBtn--text rsuBtn--text-bordered rsuBtn--md margin-0 jsPagingButton");1==b&&c.addClass("rsuBtn--disabled-link");c.attr("href","#resultsTable");c.html('<i class="icon icon-angle-left margin-0 margin-r-10"></i><span class="hidden-md-down">Previous</span>');a.prepend($(c).click(function(f){if(!$(c).hasClass("rsuBtn--disabled-link"))return Results.changePage(e),!1}))})(b);var d=
this.numPages;(function(){var e=Results.currentPage+1,c=$(document.createElement("a"));c.addClass("rsuBtn rsuBtn--text rsuBtn--text-bordered rsuBtn--md margin-0 jsPagingButton");b==d&&c.addClass("rsuBtn--disabled-link");c.attr("href","#resultsTable");c.html('<span class="hidden-md-down">Next</span><i class="icon icon-angle-right rsuBtn--icon-right margin-0 margin-l-10"></i>');a.append($(c).click(function(f){if(!$(c).hasClass("rsuBtn--disabled-link"))return Results.changePage(e),!1}))})(b,d)}},editColumns:function(a){a=
this.getResultsTable();var b=Results.editable?1:0,d=[],e=[];e.push(0);for(var c=0;c<this.data.headings.length;c++)this.data.headings[c].hidden&&d.push(c+b),this.data.headings[c].hidden=!1;$(a).empty();this.buildResultsTable(!1);$("div.table-results-nav").hide();$("span.noEditMode").hide();$("#divisionResultsLink, #results-embed-container").hide();$(a).find("th").addClass("noSort");$(a).find("th").off("click.sort");$(a).find("tbody > tr > td:first-child button").prop("disabled",!0);$(a).addClass("editMode");
"undefined"!=typeof TableEditing&&TableEditing.setupColumningOrdering(a,Results.editable);TableEditing.editColumns(a,d,e)},saveColumns:function(a){var b=this;b.showOverlay();var d=b.getResultsTable(),e=TableEditing.stopEditingColumns(d);a.off("click").on("click",function(){Results.editColumns($(this))}).text(a.data("initial-text"));a=urlAddParam(""+window.location,"resultSetId",this.data.resultSet.setInfo.individual_result_set_id);a=urlAddParam(a,"action","customize");for(var c={},f=Results.editable?
1:0,h=f;h<e.length;h++){var g=jQuery.extend(!0,{},e[h]);g.hidden=g.hidden?"T":"F";c[this.data.headings[$.data(d.tHead.rows[0].cells[h],"headerKey")].key]=g}$.ajax({url:a,type:"POST",dataType:"json",data:{headings:c,csrf:rsuCsrf}}).done(function(l){l||(l={error:"Failed to save settings."});if(l.error)b.showError(l.error);else{for(l=f;l<e.length&&l<d.tHead.rows[0].cells.length;l++){var m=b.data.headings[$.data(d.tHead.rows[0].cells[l],"headerKey")];m.name=e[l].text;m.hidden=e[l].hidden}$(d).empty();
b.loadResults();$(d).removeClass("editMode");$("div.table-results-nav").show();$("span.noEditMode").show();$("#divisionResultsLink, #results-embed-container").show()}}).fail(function(){b.showError("Failed to save settings.")}).always(function(){b.hideOverlay()})},addResult:function(){this.resultsEditPopup&&Results.showEditResultPopup(null,{countrycode:"US"},"Add")},addVirtualResult:function(){var a=$("#addVirtualResultsPopup");showStyle1Popup(a,"Add Virtual Result",Math.min(800,$(window).width()));
a.find("form").off("submit").on("submit",function(b){b.preventDefault();b=$(this).prop("action");var d=a.find("input[name='vr_first_name']").val(),e=a.find("input[name='vr_last_name']").val();""!==d&&""!==e&&(b+="&firstName="+encodeURIComponent(d)+"&lastName="+encodeURIComponent(e)+"&q=");window.location=b})},deleteResult:function(a,b){var d=this,e=$("#deleteResultPopup");e.find("span[data-placeholder='name']").text(b);showStyle1Popup(e,"Delete Result",Math.min(500,$(window).width()));var c=!1;e.find("button[type='submit']").off("click").on("click",
function(){if(!c){c=!0;var f=this,h=$(this),g=h.data("waiting-class"),l=f.className;g&&(f.className=g);var m=h.html();h.html("Deleting Result&hellip;");g={url:h.data("submit-url"),type:"POST",dataType:"json",data:{csrf:e.data("csrf"),eventId:d.data.resultSet.setInfo.race_category_id,individual_result_set_id:d.data.resultSet.setInfo.individual_result_set_id,individual_result_id:a}};e.find("input[name='place_adjustment']").is(":checked")&&(g.data.place_adjustment="T");$.ajax(g).done(function(n){n.success?
(e.dialog("close"),Results.dontCacheNextRefresh=!0,Results.refreshResults()):showError("Failed to delete result.")}).fail(function(){showError("Failed to delete result.")}).always(function(){f.className=l;h.html(m);c=!1})}})},editResult:function(a){if(this.resultsEditPopup&&a<this.data.resultSet.resultIds.length){this.resultsEditingWaitingPopup.dialog("open");this.resultsEditingWaitingPopup.data("allowClose",!1);var b=this.data.resultSet.resultIds[a],d=urlAddParam(""+window.location,"resultSetId",
this.data.resultSet.setInfo.individual_result_set_id);d=urlAddParam(d,"resultId",b);var e={type:"GET",dataType:"json",url:d,timeout:15E3};(function(){$.ajax(e).done(function(c){c.error?Results.showError(c.error):(Results.resultsEditingWaitingPopup.data("allowClose",!0),Results.resultsEditingWaitingPopup.dialog("close"),Results.showEditResultPopup(a,c.result,"Edit"))}).fail(function(){Results.showError("Request failed.")})})()}},showEditResultPopup:function(a,b,d){Results.resultsEditPopup.dialog({title:d+
" Result",closeText:""});this.resultsEditPopup.find("div.error").empty();this.resultsEditPopup.data("result",b);this.resultsEditPopup.find("div.dynamicContainer").empty();d=this.resultsEditPopup.find(":input:not(:submit)");for(a=0;a<d.length;a++){var e=d[a].name;if("individual_result_set_id"==e)var c=this.data.resultSet.setInfo.individual_result_set_id;else"eventId"==e?c=this.data.resultSet.setInfo.race_category_id:(c=e in b&&null!==b[e]?""+b[e]:"",d.eq(a).data("resultKey",e));"csrf"!==e&&(d.eq(a).val(c),
"countrycode"==e&&d.eq(a).change())}a=this.data.resultSet.setInfo.tally_field_type;d=this.resultsEditPopup.find(".tally");d.find("input").prop("disabled");d.prop("hidden",!a);a&&(d=d.find("div[data-tally-type]"),d.prop("hidden",!0),a=d.filter("[data-tally-type='"+a+"']"),0===a.length&&(a=d.filter("[data-tally-type='']")),a=a.prop("hidden",!1).find("input").prop("disabled",!1),(d=a.data("divisor"))||(d=1),a.filter("[name='result_tally_value']").val(b.result_tally_value/d));e=$("#resultsPopup-editResults-divisionTemplate");
var f=this.resultsEditPopup.find("div.dynamicContainer[data-container='divisions']");if(this.data.divisions)for(a=0;a<this.data.divisions.length;a++){d=e.clone();d.removeAttr("id");c=d.find("span.placeholder");setupPlaceholders(c);var h=this.data.divisions[a],g="division_"+h.race_division_id+"_placement";d.find(":input").each(function(){this.disabled=!1;this.name=this.name.replace("[-]","["+h.race_division_id+"]");this.value=g in b&&b[g]?""+b[g]:"";$.data(this,"resultKey",g)});fillInPlaceholders(c,
h);f.append(d);d.prop("hidden",!1)}e=$("#resultsPopup-editResults-splitTemplate");f=this.resultsEditPopup.find("div.dynamicContainer[data-container='splits']");if(this.data.resultSet.splits)for(a=0;a<this.data.resultSet.splits.length;a++){d=e.children().clone();c=d.find("span.placeholder");setupPlaceholders(c);var l=this.data.resultSet.splits[a];d.find(":input").each(function(){this.disabled=!1;this.name=this.name.replace("[-]","["+l.split_id+"]");var m="split_"+l.split_id;/^splitPlace/.test(this.name)&&
(m+="_place");this.value=m in b&&b[m]?""+b[m]:"";$.data(this,"resultKey",m)});fillInPlaceholders(c,l);f.append(d);d.prop("hidden",!1)}a=$("#resultsPopup-editResults-customFieldTemplate");e=this.resultsEditPopup.find("div.dynamicContainer[data-container='fields']");if(this.data.resultSet.extraFields)for(fieldId in this.data.resultSet.extraFields)d=a.clone(),d.removeAttr("id"),c=d.find("span.placeholder"),setupPlaceholders(c),f=this.data.resultSet.extraFields[fieldId],g="field_"+fieldId+"_value",d.find(":input").each(function(){this.disabled=
!1;this.name=this.name.replace("[-]","["+fieldId+"]");this.value=g in b&&b[g]?""+b[g]:"";$.data(this,"resultKey",g)}),fillInPlaceholders(c,f),e.append(d),d.prop("hidden",!1);Results.resultsEditPopup.data("edited",!1);Results.resultsEditPopup.find(":input").off("change.edited").on("change.edited",function(){Results.resultsEditPopup.data("edited",!0)});Results.resultsEditPopup.dialog("open")},formatName:function(a,b,d,e,c){a=$(a).find("td").eq(b);b=$("#participantNameTemplate").clone().removeAttr("id");
var f=b.find(".rsuCircleImg"),h=a.text(),g=h.substring(0,d);d=h.substring(d+1);a.empty();b.find(".participantName__name__firstName").text(g);b.find(".participantName__name__lastName").text(d);e&&(c&&""!==c?(f.removeClass("rsuCircleImg--firstChar"),f.css("background-image","url("+htmlspecialchars(c)+")")):f.find("span").text(g.substring(0,1)),b.find(".participantName__image").prop("hidden",!1));b.prop("hidden",!1);a.empty().append(b);return h},formatSimpleParticipant:function(a,b,d,e,c,f,h,g,l){var m=
[],n=$("#simpleParticipantTemplate").clone().removeAttr("id"),k=n.find(".rsuCircleImg");a=$(a).find("td").eq(b);b=a.text();var r=b.substring(0,d);d=b.substring(d+1);null!==f&&""!==f&&(f=n.data("gender"+f.toUpperCase()),m.push(f));null!==h&&""!==h&&m.push(h);null!==g&&""!==g&&m.push(g);n.find(".placeholder[data-placeholder='firstName']").text(r);n.find(".placeholder[data-placeholder='lastName']").text(d);n.find(".placeholder[data-placeholder='genderAgeState']").text(m.join(", "));null!==l&&""!==l&&
n.find(".placeholder[data-placeholder='bibNum']").text("#"+l);e&&(c?(k.removeClass("rsuCircleImg--firstChar"),k.css("background-image","url("+htmlspecialchars(c)+")")):k.find("span").text(r.substring(0,1)),n.find(".placeholder[data-placeholder='image']").prop("hidden",!1));n.prop("hidden",!1);a.empty().append(n);return b},formatRaceGroupName:function(a,b,d){a=$(a).find("td").eq(b);var e=a.text();if(""!==e){var c=/^\[((?:[^\]]|\\\]|\\\[)+)\]\((.*)\)$/;b=$(document.createElement("i")).addClass("icon icon-external-link").attr("aria-hidden",
!0);e=$(document.createElement("a")).text(e+" ");if("string"===typeof d){var f=c.exec(d);null!==f&&e.attr("href",f[2]).attr("target","_blank")}else e.on("click",function(h){h.preventDefault();h=$("#teamResultsUrlPickPopup");var g=h.find(".teamUrls"),l=g.children().eq(0);g.children().not(l).remove();for(var m=$jscomp.makeIterator(d),n=m.next();!n.done;n=m.next())if(n=c.exec(n.value),null!==n){var k=l.clone();k.find("a").text(n[1].replace(/\\(\]|\[)/g,"$1")).attr("href",n[2]);k.prop("hidden",!1);g.append(k)}showStyle1Popup(h,
h.data("title"),600);g.children().not(l).eq(0).find("a").focus()});e.on("click",function(h){h.stopPropagation()});e.append(b);a.empty().append(e)}},cancelEditResult:function(){Results.resultsEditPopup&&Results.resultsEditPopup.dialog("close")}};$(function(){Results.init()});

//9086a1e103eb9cce5d97d41ec0cd7b54
